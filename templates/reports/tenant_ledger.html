{% extends 'authapp/base.html' %}
{% load static %}

{% block headscripts %}
    <link rel="stylesheet" href="{% static 'authapp/assets/examples/css/pages/invoice.css' %}">
    <link rel="stylesheet" href="{% static 'authapp/global/vendor/bootstrap-sweetalert/sweetalert.css' %}">
    <link rel="stylesheet" href="{% static 'authapp/global/vendor/footable/footable.core.css' %}">
    <link rel="stylesheet" href="{% static 'authapp/assets/examples/css/tables/footable.css' %}">

{% endblock %}

{% block title %}

    <title>Payment Ledger | MNEST Africa</title>
{% endblock %}

{% block page %}

    <!-- Page -->
    <div class="page">
        <div class="page-header">
            <h1 class="page-title">Payment Ledger</h1>
        </div>

        <div class="page-content">
            <!-- Panel -->
            <div class="panel">
                <div class="panel-body container-fluid">


                    <div class="col-xl-12 col-lg-12">
                        <!-- Card -->
                        <div class="card-group">
                            <div class="card card-block p-20">
                                <div class="counter counter-lg text-left pl-20">
                                    <span class="counter-number"></span>
                                    <div class="counter-label text-uppercase">
                                        Premises: {{ tenant.unit.unit_name }} {{ tenant.unit.property.property_name }}</div>
                                    <div class="counter-label text-uppercase">
                                        Tenant: {{ tenant.profile.first_name }} {{ tenant.profile.last_name }}</div>
                                    <div class="counter-label text-uppercase">
                                        Landlord: {{ tenant.unit.property.company.name }}</div>
                                </div>
                            </div>
                        </div>
                        <!-- End Card -->
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            {#                            <form method="get">#}
                            {#                                <div class="well">#}
                            {#                                    <h4 style="margin-top: 0">Filter</h4>#}
                            {#                                    <div class="row">#}
                            {#                                        <div class="form-group col-sm-8 col-md-3">#}
                            {#                                            Property:#}
                            {#                                            {{ InvFilter.form.unit__property }}#}
                            {#                                        </div>#}
                            {#                                        <div class="form-group col-sm-8 col-md-3">#}
                            {#                                            Unit:#}
                            {#                                            {{ InvFilter.form.unit }}#}
                            {#                                        </div>#}
                            {#                                        <div class="form-group col-sm-8 col-md-3">#}
                            {#                                            {{ InvFilter.form.status.label_tag }}#}
                            {#                                            {{ InvFilter.form.status }}#}
                            {#                                 exampleTableTools       </div>#}
                            {#                                    </div>#}
                            {#                                    <button type="submit" class="btn btn-primary">#}
                            {#                                        <span class="wb wb-search"></span> Search#}
                            {#                                    </button>#}
                            {#                                </div>#}
                            {#                            </form>#}
                        </div>
                        <div class="col-lg-3 offset-lg-6 text-right">

                        </div>
                    </div>

                    <div class="page-invoice-table table-responsive">
                        <button type="button" class="btn btn-animate btn-animate-side btn-default btn-outline"
                                onclick="javascript:window.print();">
                            <span><i class="icon wb-print" aria-hidden="true"></i> Print</span>
                        </button>


                        <!-- End Example Tabs -->
                        <table class="table table-bordered table-hover toggle-circle" id="ledger"
                               data-sorting="true" data-filtering="true">
                            <thead>
                            <tr>
                                <th>Month</th>
                                <th>Rent Due</th>
                                <th>Late fees</th>
                                <th>Other Fee</th>
                                <th>Waiver</th>
                                <th>Rent Paid</th>
                                <th>Date Paid</th>
                                <th>Balance</th>
                                <th data-name="status">Status</th>
                            </tr>
                            </thead>
                            <tfoot>
                            <tr>
                                <th>Total</th>
                                <th>KES. {{ rent_total }}</th>
                                <th>KES. {{ late_total }}</th>
                                <th>KES. {{ other_total }}</th>
                                <th>KES. {{ waiver_total }}</th>
                                <th colspan="2">KES. {{ paid_total }}</th>
                                <th colspan="2">KES. {{ bal_total }}</th>

                            </tr>
                            </tfoot>
                            <tbody>
                            {% for b in inv %}
                                <tr>
                                    <td>{{ b.month }} {{ b.year }}</td>
                                    <td>{{ b.rent }}</td>
                                    <td>{{ b.delay }}</td>
                                    <td>{{ b.other }}</td>
                                    <td>{{ b.waiver }}</td>
                                    <td>{{ b.paid }}</td>
                                    <td>{{ b.date_paid }}</td>
                                    <td>{{ b.balance }}</td>

                                    <td>{% if b.status %}
                                        Closed
                                    {% else %}
                                        Open
                                    {% endif %}</td>

                                </tr>
                            {% endfor %}

                            </tbody>
                        </table>
                    </div>
                    <div class="text-right">

                    </div>
                </div>
            </div>
            <!-- End Panel -->
        </div>
    </div>
    <!-- End Page -->

{% endblock %}
{% block footscripts %}
    <script src="{% static 'authapp/global/vendor/footable/footable.min.js' %}"></script>
    <script src="{% static 'authapp/global/vendor/asrange/jquery-asRange.min.js' %}"></script>
    <script src="{% static 'authapp/global/vendor/bootstrap-sweetalert/sweetalert.js' %}"></script>
    <script src="{% static 'authapp/global/js/Plugin/bootstrap-sweetalert.js' %}"></script>
{#    <script src="{% static 'authapp/assets/examples/js/tables/footable.js' %}"></script>#}
    <script>
        (function (global, factory) {
            if (typeof define === "function" && define.amd) {
                define('/tables/footable', ['jquery', 'Site'], factory);
            } else if (typeof exports !== "undefined") {
                factory(require('jquery'), require('Site'));
            } else {
                var mod = {
                    exports: {}
                };
                factory(global.jQuery, global.Site);
                global.tablesFootable = mod.exports;
            }
        })(this, function (_jquery, _Site) {
            'use strict';

            var _jquery2 = babelHelpers.interopRequireDefault(_jquery);

            (0, _jquery2.default)(document).ready(function ($$$1) {
                (0, _Site.run)();
            });

            // Filtering
            // ---------
            (function () {
                FooTable.MyFiltering = FooTable.Filtering.extend({
                    construct: function construct(instance) {
                        this._super(instance);
                        this.statuses = ['Open', 'Closed'];
                        this.def = 'Any Status';
                        this.$status = null;
                    },
                    $create: function $create() {
                        this._super();
                        var self = this,
                            $form_grp = (0, _jquery2.default)('<div/>', {
                                'class': 'form-group'
                            }).append((0, _jquery2.default)('<label/>', {
                                'class': 'sr-only',
                                text: 'Status'
                            })).prependTo(self.$form);

                        self.$status = (0, _jquery2.default)('<select/>', {
                            'class': 'form-control'
                        }).on('change', {
                            self: self
                        }, self._onStatusDropdownChanged).append((0, _jquery2.default)('<option/>', {
                            text: self.def
                        })).appendTo($form_grp);

                        _jquery2.default.each(self.statuses, function (i, status) {
                            self.$status.append((0, _jquery2.default)('<option/>').text(status));
                        });
                    },
                    _onStatusDropdownChanged: function _onStatusDropdownChanged(e) {
                        var self = e.data.self,
                            selected = (0, _jquery2.default)(this).val();
                        if (selected !== self.def) {
                            self.addFilter('status', selected, ['status']);
                        } else {
                            self.removeFilter('status');
                        }
                        self.filter();
                    },
                    draw: function draw() {
                        this._super();
                        var status = this.find('status');
                        if (status instanceof FooTable.Filter) {
                            this.$status.val(status.query.val());
                        } else {
                            this.$status.val(this.def);
                        }
                    }
                });

                FooTable.components.register('filtering', FooTable.MyFiltering);
                var filtering = (0, _jquery2.default)('#ledger');
                filtering.footable();
            })();
        });
    </script>
    {#    <script>#}
    {#        (function (document, window, $) {#}
    {#            'use strict';#}
    {##}
    {#            var Site = window.Site;#}
    {#            $(document).ready(function () {#}
    {#                Site.run();#}
    {#            });#}
    {#        })(document, window, jQuery);#}
    {#    </script>#}

{% endblock %}
